---
title: Text Generation Part 3
status: pending
---
<div class="container mt-4">
<h1>Text generation Part Four</h1>
<p class="lead">Prerequisites: You should have read <a href="{{ site.baseurl }}{% link _tutorials/phrases2.html %}">Text Generation Part Three</a>.</p>
<p>We are now ready to look at phrase factories and tackle recursion</p>	
<h2>Phrase Factories</h2>

<p>A phrase factory is a function that generates a new instance of <code>ishml.Phrase</code>. The <code>ishml.Template</code> object and its many prefixes are phrase factories. The suffixes of <code>ishml.Phrase</code> are phrase factories. However, not all methods of <code>ishml.Phrase</code> are phrase factory.  Some merely return the existing phrase rather than a new instance.  Take a look at listing 1</p>

<span class="badge badge-info">Listing 1</span>
<iframe id="listing1" width="100%" height="500" scrolling="no" src="//jsfiddle.net/bikibird/d5a023vc/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 1"></iframe>

<p>Here an attempt was made to create new phrases from the <code>animal</code> phrase.  It does not work because <code>.populate()</code> merely returns the original animal phrase with new data and does not generate a new phrase. As a result, both <code>example1</code> and <code>example2</code> refer to the same instance of <code>ishml.Phrase </code> that <code>animal</code> does.  Instead of producing an amphibian and a rodent respectively, the examples both produce rodents because that was the last set of data populated.</p>

<p>Listing two below demonstrates how to properly create a phrase factory. Here <code>example1</code>and <code>example2</code> reference separate instances of <code>ishml.Phrase</code> and act independently of each other.</p> 

<span class="badge badge-info">Listing 2</span>
<iframe id="listing2" width="100%" height="350" scrolling="no" src="//jsfiddle.net/bikibird/0k8jysud/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 2"></iframe>
<p>A phrase factory is made by simply creating a function that returns new instance of <code>ishml.Phrase</code>. Phrase factories are very useful for recursive phrases. They are also used for extending <code>ishml.Template</code> and <code>ishml.Phrase</code> as we shall see in <a href="{{ site.baseurl }}{% link _tutorials/phrases5.html %}">part five</a>.</p>
<h2>Recursion</h2>
<p>In <code>example1</code> of listing 3 below, we see a simple, non-recursive phrase for generating an unordered html list.  This is fine as far is it goes, but what if we want to generate a list that automatically nests to match deeply nested data.  Recursion is used in <code>example2</code> to provide a phrase that expands indefinitely dependent on the data provided.</p>

<span class="badge badge-info">Listing 3</span>
<iframe id="listing3" width="100%" height="250" scrolling="no" src="//jsfiddle.net/bikibird/1anfe392/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 3"></iframe>

<p>A phrase factory function is assigned to the variable <code>ul</code>.  The phrase generated by this function also includes a call to the phrase factory function, making it recursive.  The second expression in the phrase checks to see if <code>.list</code> is present in  the <code>data</code>collection.  If it is, <code>.list</code> is passed in a call to <code>ul</code>.  This creates another phrase inside phrase.  This will continue recursively as long as <code>.list</code> is present.  If it is not present, the expression evaluates to an empty string.  When writing recursive functions you must always ensure that there is always a way for the recursion to end, otherwise you will generate a stack overflow error.  In this case, the absence of a <code>.list</code> provides a means of exiting the recursion.</p>

<p>List 4 shows another example of a recursive phrase. </p>

<span class="badge badge-info">Listing 4</span>
<iframe id="listing4" width="100%" height="600" scrolling="no" src="//jsfiddle.net/bikibird/e067Lgov/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 4"></iframe>
<p>The phrase factory, <code>inside</code> creates a phrase about opening a random number of containers, each inside the other and eventually revealing a treasure of some sort.  This function is called recursively as long as the result of <code></code>_.favor(...)</code> is a container.</p>
<p>Notice the use of <code>.restrict</code>. Under normal circumstances a tag that is created anywhere in a phrase is available everywhere in the phrase. The <code>.restrict()</code> method keeps the tag <q>contents</q> to be local to the phrase. Because <code>inside</code> generates phrases recursively, there are multiple tags named <q>contents</q>, one at each level of nesting.  If the <q>contents</q> tag was not restricted to the local level, the <q>contents</q> property of the tags collection would be overwritten with the most dee would be moved to the top level and overwrite each other.   </p>


<p>Continue to <a href="{{ site.baseurl }}{% link _tutorials/phrases5.html %}">part five</a> to learn about recursive phrases.</p>

	
</div>    

       
