---
title: Text Generation Part 4
status: pending
---
<div class="container mt-4">
<h1>Text generation Part Four</h1>
<p class="lead">Prerequisites: You should have read <a href="{{ site.baseurl }}{% link _tutorials/phrases3.html %}">Text Generation Part Three</a>.</p>
<p>We are now ready to look at phrase factories and tackle recursion.</p>	
<h2>Phrase Factories</h2>

<p>A phrase factory is a function that generates a new instance of <code>ishml.Phrase</code>. The <code>ishml.Template</code> object and its many prefixes are phrase factories. The suffixes of <code>ishml.Phrase</code> are phrase factories. However, not all methods of <code>ishml.Phrase</code> are phrase factory.  Some merely return the existing phrase rather than a new instance.  Take a look at listing 1.</p>

<span class="badge badge-info">Listing 1</span>
<iframe id="listing1" width="100%" height="300" scrolling="no" src="//jsfiddle.net/bikibird/d5a023vc/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 1"></iframe>

<p>Here an attempt was made to create new phrases from the <code>animal</code> phrase.  It does not work because <code>.populate()</code> merely returns the original <code>animal</code> phrase with new data and does not generate a new phrase. As a result, both <code>example1</code> and <code>example2</code> refer to the same instance of <code>ishml.Phrase </code> that <code>animal</code> does.  Instead of producing an amphibian and a rodent respectively, the examples both produce rodents because that was the last set of data populated.</p>

<p>Listing two below demonstrates how to properly create a phrase factory. Here <code>example1</code> and <code>example2</code> reference separate instances of <code>ishml.Phrase</code> and act independently of each other.</p> 

<span class="badge badge-info">Listing 2</span>
<iframe id="listing2" width="100%" height="300" scrolling="no" src="//jsfiddle.net/bikibird/0k8jysud/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 2"></iframe>
<p>A phrase factory is made by simply creating a function that returns new instance of <code>ishml.Phrase</code>. Phrase factories are very useful for recursive phrases. They may also be used to extend <code>ishml.Template</code> and <code>ishml.Phrase</code>.</p>
<h2>Recursion</h2>
<p>In <code>example1</code> of listing 3 below, we see a simple, non-recursive phrase for generating an unordered HTML list.  This is fine as far is it goes, but it would be more useful if it automatically genereated sub-lists on demand to display deeply nested data.  Recursion is used in <code>example2</code> to provide a nested list that expands indefinitely to accomodate on the data provided.</p>

<span class="badge badge-info">Listing 3</span>
<iframe id="listing3" width="100%" height="350" scrolling="no" src="//jsfiddle.net/bikibird/1anfe392/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 3"></iframe>

<p>A phrase factory function is assigned to the variable <code>ul</code>.  The phrase generated by this function also includes a call to this phrase factory function, making it recursive.  The second expression in the phrase checks to see if <code>.list</code> is present in  the <code>data</code> collection.  If it is, the data associated with <code>.list</code> is passed in the call to <code>ul</code>.  This embeds a new instance of the phrase inside the phrase.  The embedding of a new phrase will continue recursively as long as <code>.list</code> property is present in the phrase's data collection.  If it is not present, the expression evaluates to an empty string.  When writing recursive functions you must always ensure that there is always a way for the recursion to end, otherwise you will generate a stack overflow error. </p>

<p>List 4 shows another example of a recursive phrase. </p>

<span class="badge badge-info">Listing 4</span>
<iframe id="listing4" width="100%" height="400" scrolling="no" src="//jsfiddle.net/bikibird/e067Lgov/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 4"></iframe>

<p>The phrase factory, <code>inside</code> creates a phrase about opening a random number of containers, each inside the other and eventually revealing a treasure of some sort.  This function is called recursively as long as the result of <code></code>_.favor(...)</code> is a container.</p>
<h2>Modifying and Customizing</h2>
<p id="modify">We have now covered the essentialss of  working with ISHML phrases and templates. We have introduced most of built-in prefixes and suffixes, which should cover the majority of your text generation needs. Occasionally, you may want to use a custom function to modify the results of a phrase.  Listing 5 introduces the <code>.modify()</code> suffix in <code>example1</code>.  It takes a callback function as its argument.  During evaluation, each is element in the phrase's result array is sent to the callback function. The callback funtion returns a text string that <code>.modify()</code> replaces in the results array.</p>
<span class="badge badge-info">Listing 5</span>
<iframe id="listing5" width="100%" height="400" scrolling="no" src="//jsfiddle.net/bikibird/5od3v4Le/embedded/js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow wrap" title="Listing 5"></iframe>
<p id="prefix"></p>While <code>.modify()</code> lets us apply modifications to phrases, the syntax is a bit bulky compared to custom prefixes and suffixes.  Any function that returns a phrase, i.e., a phrase factory, can be defined as a custom prefix or suffix.  In the listing above, the variable <code>prefix</code> is assigned to a phrase factory that does the same uppercase conversion seen in example1.  The static method <code>ishml.Template.define</code> adds the phrase factory to the collection of available prefixes with the name <q>shout</q>.  In <code>example2</code> we see the newly defined <code>.shout</code> prefix in use.</p>
<p id="suffix">We may also create simple suffixes that take no parameters by using the static method <code>ishml.Phrase.define</code>.  In the list above we define a suffix called <q>tron</q> to append <q>O-Tron</q> to the ends of phrases.  We use the <code>.tron</code> suffix in <code>example3</code>.</p>
<p>We could have just as easily made the <code>.tron</code> suffix a prefix; there really isn't much advantage of one over the other.  However, as a general rule, if the intent is to modify the end of the phrase, it is better to create a suffix.  It just makes the subsequent phrase definitions easier to read.</p>
<h2>Next Steps</h2>
<p>This has been a brief tour of text generation using the ISHML API. We did not cover all of the available prefixes and suffixes.  See the <a href="{{ site.baseurl }}{% link api.html %}">API Reference</a> for complete documentation.</p>
<p>I will happily answer any questions you may have about text generation on <a href="https://intfiction.org">intfiction.org</a>. Be sure to label your questions with the <span class="badge badge-info">ISHML</span> tag for promptest attention.</p>
</div>    

       
