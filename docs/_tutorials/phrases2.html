---
title: Text Generation Part 2
status: pending
---
<div class="container mt-4">
<h1>Text generation Part Two</h1>
<p class="lead">Prerequisites: You should have read <a href="{{ site.baseurl }}{% link _tutorials/phrases1.html %}">Text Generation Part One</a>.</p>

<h2>Anatomy of a Phrase</h2>	
<p>Stored inside a phrase is an array of text strings, sub-phrases, numbers, and functions that make up the phrase. When a phrase's <code>.say()</code> method is called, the phrase is evaluated and the phrase's <code>text</code> property is updated.  The default evaluation is to join all the elements of the array together.  If an array element is another phrase or a function, it will be evaluated before concatenation.   We can change the default evaluation by adding modifiers to the phrase's definition. Modifiers that are methods of <code>ishml.Phrase</code> are called <b>prefixes</b>.  Modifiers that are methods of the text generation function created by <code>ishml.Phrase</code> are called <b>suffixes</b>.  A key characteristic of modifiers is that they always return a new phrase.  Modifiers may be chained together to create complex phrases with just a single line of code. </p>

<p>The JavasScript tab in Listing 1 shows examples of prefixes in use.  An alphabetical list of all built-in prefixes is available in the <a href="{{ site.baseurl }}{% link api.html %}">API Reference</a>. </p>
<span class="badge badge-info">Listing 1</span>
<iframe id="listing1" width="100%" height="275" src="//jsfiddle.net/bikibird/40nh7ev2/embedded/html,js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow" title="Listing 1"></iframe>
<p>The phrase defined for <code>unmodifiedPhrase</code> evaluates to <q>JackJillJamal went to the humane society and came home with dogcatocelotemu.</q> </p>
<p>Adding the <code>.pick</code> prefix to the inner phrases of <code>pickPhrase</code> causes a name and an animal to be chosen at random each time <code>.say</code> is called. The inner phrases of <code>cyclePhrase</code> uses the <code>.cycle</code> prefix to cause names and animals to be selected in order, looping around to the begin again once the list is exhausted.</p>
<p>The <code>.a</code> prefix adds the appropriate indefinite article, <q>a</q> or <q>an</q> to the animal selected by <code>.pick</code> animal.</p>
<h2>Prefix Precedence</h2>
<p>An unlimited number of prefixes may by chained together with dot notation to apply layer upon layer of modifications.  Prefixes are applied from right to left. That is, the prefix closest to the left parenthesis or backtick is applied to the base phrase first. Then the next closest prefix is applied to that result and so on until the beginning of the chain is reached.  Changing the order of prefixes often changes the final result of text generation. </p>
<span class="badge badge-info">Listing 2</span>
<iframe id="listing2" width="100%" height="300" src="//jsfiddle.net/bikibird/9uvfsam1/embedded/html,js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow" title="Listing 2"></iframe>
<p>Examine the JavaScript in Listing 2.  The <code>example1</code> phrase applies the appropriate indefinite article to the list as a whole.  The <code>example2</code> phrase applies the indefinite article to each animal individually before creating the list. This is solely due to the order in which the prefixes are chained.  The <code>example3</code> phrase capitalizes the first letter of the phrase.  The <code>example4</code> phrase capitalizes the first letter of each animal.</p>
<h3>Generating Random Text</h3>
<p>Three prefixes inject randomness into phrase evaluation, each in different ways. Study Listing 3. The <code>.pick</code> prefix selects an element from the phrase's array purely at random, like rolling a pair of dice.</p>
<span class="badge badge-info">Listing 3</span>
<iframe id="listing3" width="100%" height="300" src="//jsfiddle.net/bikibird/ob3815mu/embedded/html,js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow" title="Listing 3"></iframe>
<p>The <code>.favor</code> prefix weights the selection so that there is a decreasing likelihood of an element being selected the further down it is in the list. For example, in an array with 5 elements, the first element is 5 times more likely to be selected than the last element, the second element is 4 times more likely than the last, and so on. Specifically, the mathematical odds of selecting the element at index <var>i</var> of an array of length <var>n</var> is ( <var>n</var> - <var>i</var> ) out of <var>n</var> * ( <var>n</var> + 1 ) / 2.  In an array with 5 elements, this translates to odds of 5:15, 4:15, 3:15, 2:15, and 1:15 for each element respectively.  
<p>The <code>.pick</code> and <code>.favor</code> prefixes will sometimes generate the same alternative more than one time in a row since they choose purely at random with no memory of past selections. The <code>.shuffle</code> prefix shuffles the elements of the array like a deck of cards.  When used in conjunction with <code>.cycle</code> it ensures that each alternative will be dealt out in random order before reshuffling the array when the cycle repeats.</p>
<p>ISHML's random number generator is deterministic. In other words, the so-called random selection prefixes are based on a mathematical formula that mimics true randomness. This pseudorandomness is generally good enough for most text generation needs in most applictaions.   Because the results are deterministic, we can actually control the outcomes of the random selection prefix by setting a phrase's <i>seed</i>. Take a look as Listing 4.</p>
<span class="badge badge-info">Listing 4</span>
<iframe id="listing4" width="100%" height="300" src="//jsfiddle.net/bikibird/uz8njatv/embedded/html,js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow" title="Listing 4"></iframe>
<p>The <code>example1</code> will produce different results with every click of the Click Me button, even if the script is rerun by clicking on the results link.</p><p>The <code>example2</code> phrase runs through the same sequence starting with taking third in the race twice and then losing.  Even clicking the results link will not change the outcomes of the races. The fix is in because the phrase's seed was set to a specific value with <code>.seed()</code>.  A seed may be any numeric value less than one, but not less than zero.  Setting the seed of a phrase guarantees reproducible results. Different seeds will generate different results. (The <code>.seed()</code> method is considered phrase modifying suffix.  We will talk more about suffixes in part three of this tutorial.)</p>
<p>Alternatively, the seed may be set using the phrase's <code>.say()</code> method as seen in <code>example3</code>. Because the same seed is used every time this phrase's text is generated, the outcome is always the same.</p>
<h2>Pinning Things Down</h2>
<p>Listing 5 below introduces the <code>.pin</code> prefix. Normally, when the cycle repeats, the <code>.cycle</code> prefix sends a reset command to the prefix to the right of it and then that prefix resets itself and passes the reset command down the prefix chain.  However, the <code>.pin</code> prefix stops the reset command from propagating further. The behavior of <code>shufflePhrase</code> is to reshuffle the list everytime the cycle completes a loop through the list.  The addition of the <code>.pin</code> prefix in <code>pinShufflePhrase</code> stops the reset command before it reaches <code>.shuffle</code>, which prevents the list from being reshuffled. </p>
<span class="badge badge-info">Listing 5</span>
<iframe id="listing5" width="100%" height="250" src="//jsfiddle.net/bikibird/c8pLftxm/embedded/html,js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow" title="Listing 5"></iframe>
<h2>Series</h2>
<p>The <code>.series</code> prefix selects each element from the phrase's array in order, like <code>.cyle</code>, but once it reaches the end of the list, it returns the empty string instead of looping back to the beginning.  See Listing 6. </p>
<span class="badge badge-info">Listing 6</span>
<iframe id="listing6" width="100%" height="250" src="//jsfiddle.net/bikibird/cqte4p15/embedded/html,js,result/?fontColor=ffffff&menuColor=17a2b8" frameborder="0" class="rounded shadow" title="Listing 6"></iframe>
<p>Continue to <a href="{{ site.baseurl }}{% link _tutorials/phrases3.html %}">part three</a> to learn about phrase suffixes.</p>

</div>    

       
